(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{25:function(e,t,n){e.exports=n(58)},34:function(e,t,n){},36:function(e,t,n){},38:function(e,t,n){},40:function(e,t,n){},42:function(e,t,n){},44:function(e,t,n){},46:function(e,t,n){},48:function(e,t,n){},50:function(e,t,n){},56:function(e,t,n){},58:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),i=n(22),c=n.n(i),l=n(11),r=n(2),s=n(5),u=n(13),d=n(10),m=n(14),g=(n(34),n(3)),f=function e(t,n,o,a){Object(r.a)(this,e),this.id=void 0,this.title=void 0,this.from=void 0,this.to=void 0,this.confirmed=!1,this.by=void 0,this.attendees=void 0,this.agenda=void 0,this.roomName=void 0,this.id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)}),this.title=t,this.roomName=n,this.from=o,this.to=a};n(36);var h,v=function(e){console.log("allocationInfo: ",e);var t=new Date(e.from).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),n=new Date(e.to).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1});return a.a.createElement("div",{className:"AllocationInfo"},"Next Meeting:",a.a.createElement("div",null,t," - ",n),a.a.createElement("div",null,e.by),a.a.createElement("div",null,e.title))},p=(n(38),function(e){console.log("allocationInfo: ",e);var t=new Date(e.from).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),n=new Date(e.to).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1});return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"AllocationInfoBig"},"Current Meeting:",a.a.createElement("div",null,t," - ",n),a.a.createElement("div",null,e.by),a.a.createElement("div",null,e.title),e.attendees?a.a.createElement("div",null,"Attendees: ",e.attendees):null,e.agenda?a.a.createElement("div",null,"Agenda: ",e.agenda):null))}),y=(n(40),function(e){var t=new Date(e.time).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1});return a.a.createElement("div",{className:"TimeView"},t)});n(42);!function(e){e.occupied="occupied",e.free="free",e.awaiting="awaiting"}(h||(h={}));var b,E,k=function e(t){Object(r.a)(this,e),this.name=void 0,this.capacity=void 0,this.location=void 0,this.equipment=void 0,this.name=t},S=function(e){var t,n,o;console.log("Allocation menu:",e.id),e.currentAllocation?(e.roomStatus===h.awaiting&&(n=a.a.createElement("button",{className:"btn btn_flat",onClick:function(){return e.onConfirmMeetingClick(e.currentAllocation.id)}},a.a.createElement("svg",{className:"icon"},a.a.createElement("use",{xlinkHref:"symbol-defs.svg#icon-calendar-check-o"})),a.a.createElement("span",null,"Confirm"))),t=a.a.createElement(a.a.Fragment,null,a.a.createElement("button",{className:"btn btn_flat",onClick:function(){return e.onExtendMeetingClick(e.currentAllocation.id,6e4)}},a.a.createElement("svg",{className:"icon"},a.a.createElement("use",{xlinkHref:"symbol-defs.svg#icon-calendar-plus-o"})),a.a.createElement("span",null,"Extend")),a.a.createElement("button",{className:"btn btn_flat",onClick:function(){return e.onFinishEarlyClick(e.currentAllocation.id)}},a.a.createElement("svg",{className:"icon"},a.a.createElement("use",{xlinkHref:"symbol-defs.svg#icon-calendar-times-o"})),a.a.createElement("span",null,"Finish")),n)):(e.roomStatus===h.awaiting&&(o=a.a.createElement("button",{className:"btn btn_flat",onClick:function(){return e.onConfirmMeetingClick(e.nextAllocation.id)}},a.a.createElement("svg",{className:"icon"},a.a.createElement("use",{xlinkHref:"symbol-defs.svg#icon-calendar-check-o"})),a.a.createElement("span",null,"Confirm"))),t=a.a.createElement(a.a.Fragment,null,a.a.createElement("button",{className:"btn btn_flat",onClick:function(){return e.onAddMeetingClick()}},a.a.createElement("svg",{className:"icon"},a.a.createElement("use",{xlinkHref:"symbol-defs.svg#icon-calendar-o"})),a.a.createElement("span",null,"Book now")),o));return a.a.createElement("div",{className:"AllocationMenu ".concat(e.roomStatus)},t)},C=(n(44),function(e){var t=["RoomStatusBorder"];return t.push(e.roomStatus),a.a.createElement("div",{className:t.join(" ")},e.children)}),w=(n(46),function(e){return a.a.createElement("div",{className:"EquipmentBar"},e.equipment.map(function(t){return a.a.createElement("button",{key:t.type,className:"btn btn_".concat(t.status.toLowerCase()),onClick:function(){return e.onChangeStatusClick(t)}},a.a.createElement("svg",{className:"icon icon_".concat(t.status.toLowerCase()," icon-").concat(t.type.toLowerCase())},a.a.createElement("use",{xlinkHref:"symbol-defs.svg#icon-".concat(t.type.toLowerCase())})))}))}),O=(n(48),function(e){return a.a.createElement("div",{className:"StatusBar"},a.a.createElement("div",null,e.room.name),a.a.createElement(w,{equipment:e.equipment,onChangeStatusClick:e.onChangeStatusClick}))}),x=(n(50),n(8)),j=n(4),A=n(1),I=Object(A.c)({slice:"allocation",initialState:{entity:{},ids:[]},reducers:{addAllocation:function(e,t){e.entity[t.payload.id]=t.payload,e.ids.push(t.payload.id)},finishEarly:function(e,t){e.entity[t.payload].to=Date.now()-6e4},extendMeeting:function(e,t){e.entity[t.payload.id].to+=t.payload.amount,e.entity[t.payload.id].confirmed=!0},confirmMeeting:function(e,t){e.entity[t.payload.id].confirmed=!0,e.entity[t.payload.id].from=Date.now()-6e4}}}),N=n(12);!function(e){e.Projector="display",e.WhiteBoard="users",e.Skype="skype"}(b||(b={})),function(e){e.Available="Available",e.NotAvailable="NotAvailable",e.Broken="Broken"}(E||(E={}));var T,D=function e(t,n,o){Object(r.a)(this,e),this.roomName=t,this.type=n,this.status=o},M=Object(A.c)({slice:"equipment",initialState:[],reducers:{addEquipment:function(e,t){return[].concat(Object(N.a)(e),[t.payload])},setStatus:function(e,t){return e.filter(function(e){return e.roomName===t.payload.roomName&&e.type===t.payload.type})[0].status=t.payload.status,e},changeStatus:function(e,t){var n=e.filter(function(e){return e.roomName===t.payload.roomName&&e.type===t.payload.type})[0],o=E.Available;switch(n.status){case E.Available:o=E.Broken;break;case E.Broken:o=E.NotAvailable;break;case E.NotAvailable:o=E.Available}return n.status=o,e}}}),R=Object(A.c)({slice:"room",initialState:[],reducers:{addRoom:function(e,t){return[].concat(Object(N.a)(e),[t.payload])}}}),q=Object(A.c)({slice:"ui",initialState:{selectedRoomId:"",time:Date.now()},reducers:{setSelectedRoomId:function(e,t){return e.selectedRoomId=t.payload,e},setTime:function(e,t){return e.time=t.payload,e}}}),L=Object(j.combineReducers)({ui:q.reducer,room:R.reducer,allocation:I.reducer,equipment:M.reducer}),B=Object(A.a)({reducer:L}),F=new(function(){function e(){Object(r.a)(this,e),this.sign=!1,this.onLoadCallback=void 0,this.events={},this.CLIENT_ID="162342559011-rh81oauc2fut2lj6d03j4srkk3oeea2l.apps.googleusercontent.com",this.API_KEY="AIzaSyBe9hJXEgWHgkhAjqMEnxDtyCQLVCdEByI",this.DISCOVERY_DOCS=["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],this.SCOPES="https://www.googleapis.com/auth/calendar.readonly",this.CONFIG={apiKey:this.API_KEY,clientId:this.CLIENT_ID,discoveryDocs:this.DISCOVERY_DOCS,scope:this.SCOPES},this.syncToken=null,this.handleClientLoad()}return Object(s.a)(e,[{key:"gapi",get:function(){return window.gapi}}]),Object(s.a)(e,[{key:"handleClientLoad",value:function(){var e=this,t=document.createElement("script");t.src="https://apis.google.com/js/api.js",document.body.appendChild(t),t.onload=function(){e.gapi.load("client:auth2",function(){return e.initClient()})}}},{key:"handleAuthClick",value:function(){this.gapi?this.gapi.auth2.getAuthInstance().signIn():console.log("Error: this.gapi not loaded")}},{key:"handleSignoutClick",value:function(){this.gapi?this.gapi.auth2.getAuthInstance().signOut():console.log("Error: this.gapi not loaded")}},{key:"listenSign",value:function(e){this.gapi?this.gapi.auth2.getAuthInstance().isSignedIn.listen(e):console.log("Error: this.gapi not loaded")}},{key:"sync",value:function(){var e,t=this;null==this.syncToken?(console.log("Performing full sync."),e=this.constructUpcomingEventsRequestFull()):(console.log("Performing incremental sync."),(e=this.constructUpcomingEventsRequestPartial()).syncToken=this.syncToken);!function n(o){e.pageToken=o,console.log("request body: ",e),t.gapi.client.calendar.events.list(e).then(function(e){if(console.log("synced object: ",e.result),console.log("events synced: ",e.result.items),t.events=e.result,0===t.events.items.length)console.log("No new events to sync.");else{var o=!0,a=!1,i=void 0;try{for(var c,l=t.events.items[Symbol.iterator]();!(o=(c=l.next()).done);o=!0)c.value}catch(s){a=!0,i=s}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}}var r=t.events.nextPageToken;r?(console.log("new pageToken: ",r),n(r)):(console.log("setting sync Token: ",t.events.nextSyncToken),t.syncToken=t.events.nextSyncToken,console.log("Sync complete."))}).catch(function(e){if(console.log("Sync Error: ",e),410!==e.statusCode)throw e;console.log("Invalid sync token, clearing event store and re-syncing."),t.syncToken=null,t.events=[],t.sync()})}(null)}},{key:"constructUpcomingEventsRequestFull",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"primary",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return{calendarId:e,timeMin:(new Date).toISOString(),singleEvents:!0,maxResults:t,syncToken:null,pageToken:null}}},{key:"constructUpcomingEventsRequestPartial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"primary",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=new Date;return(new Date).setDate(n.getDate()+1),{calendarId:e,singleEvents:!0,maxResults:t,syncToken:null,pageToken:null}}},{key:"listUpcomingEvents",value:function(e){return this.gapi?this.gapi.client.calendar.events.list({calendarId:"primary",timeMin:(new Date).toISOString(),showDeleted:!1,singleEvents:!0,maxResults:e,orderBy:"startTime"}).then(function(e){console.log("events: ",e.result.items);var t=!0,n=!1,o=void 0;try{for(var a,i=e.result.items[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var c=a.value,l=new f(c.summary,"Supernova",new Date(c.start.dateTime).getTime(),new Date(c.end.dateTime).getTime());B.dispatch(I.actions.addAllocation(Object(g.a)({},l)))}}catch(r){n=!0,o=r}finally{try{t||null==i.return||i.return()}finally{if(n)throw o}}}):(console.log("Error: this.gapi not loaded"),!1)}},{key:"initClient",value:function(){var e=this;this.gapi.client.init(this.CONFIG).then(function(){e.gapi.auth2.getAuthInstance().isSignedIn.listen(function(t){return e.updateSigninStatus(t)}),e.updateSigninStatus(e.gapi.auth2.getAuthInstance().isSignedIn.get()),e.onLoadCallback&&e.onLoadCallback()}).catch(function(e){console.log(e)})}},{key:"updateSigninStatus",value:function(e){e&&this.listUpcomingEvents(10),this.sign=e}}]),e}()),_=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={signedIn:F.sign},n.handleItemClick=n.handleItemClick.bind(Object(x.a)(Object(x.a)(n))),F.onLoadCallback=function(){n.setState({signedIn:F.sign}),F.listenSign(function(e){console.log(e),n.setState({signedIn:e})})},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"handleItemClick",value:function(e,t){"sign-in"===t?F.handleAuthClick():"sign-out"===t&&F.handleSignoutClick()}},{key:"sync",value:function(){F.sync()}},{key:"render",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,this.state.signedIn?a.a.createElement("button",{onClick:function(t){return e.handleItemClick(t,"sign-out")}},"sign-out"):a.a.createElement("button",{onClick:function(t){return e.handleItemClick(t,"sign-in")}},"sign-in"),a.a.createElement("button",{onClick:function(){return e.sync()}},"sync"))}}]),t}(a.a.Component),P=function(e){var t,n;return console.log("roomView: ",e),e.currentAllocation&&(e.currentAllocation.id,t=a.a.createElement(p,e.currentAllocation)),e.nextAllocation&&(n=a.a.createElement(v,e.nextAllocation)),a.a.createElement("div",{className:"RoomView"},a.a.createElement(O,Object.assign({time:e.time},e)),a.a.createElement(C,{roomStatus:e.roomStatus},a.a.createElement(y,{time:e.time}),a.a.createElement("div",{className:"Separator"}),a.a.createElement("div",{className:"RightSection"},t,n,a.a.createElement(S,{currentAllocation:e.currentAllocation,nextAllocation:e.nextAllocation,roomStatus:e.roomStatus,onFinishEarlyClick:e.onFinishEarlyClick,onExtendMeetingClick:e.onExtendMeetingClick,onConfirmMeetingClick:e.onConfirmMeetingClick,onAddMeetingClick:e.onAddMeetingClick}))),a.a.createElement(_,null))},U=Object(A.b)(["ui.time"]),H=Object(A.b)(["ui.selectedRoomId"]),V=Object(A.b)([H,"room"],function(e,t){return t.filter(function(t){return t.name===e})[0]}),W=Object(A.b)([H,"allocation"],function(e,t){return Object.values(t.entity).filter(function(t){return t.roomName===e})}),Y=Object(A.b)([U,W],function(e,t){return t.filter(function(t){return t.from<=e&&t.to>=e})}),J=Object(A.b)([U,W],function(e,t){return t.filter(function(t){return t.from>=e})}),K=Object(A.b)([J],function(e){return e.sort(function(e,t){return e.from-t.from})}),G=Object(A.b)([(T=1,Object(A.b)([K],function(e){return e.slice(0,T)}))],function(e){return e[0]}),z=Object(A.b)([Y],function(e){return e[0]}),Q=Object(A.b)([Y],function(e){return e.length>0}),X=Object(A.b)([H,"equipment"],function(e,t){return t.filter(function(t){return t.roomName===e})}),$=Object(l.b)(function(e,t){console.log("mapState: ",e);var n,o=U(e),a=V(e),i=X(e),c=(n=12e4,Object(A.b)([z,G,U],function(e,t,o){return e?e.confirmed?h.occupied:h.awaiting:t&&t.from-o<n?t.confirmed?h.occupied:h.awaiting:h.free}))(e);return{currentAllocation:Y(e)[0],equipment:i,nextAllocation:G(e),roomStatus:c,room:a,time:o}},function(e){return{onAddMeetingClick:function(t){e(I.actions.addAllocation(Object(g.a)({},new f("Ad hoc meeting","Supernova",Date.now()-6e4,Date.now()+5e4),{confirmed:!0})))},onConfirmMeetingClick:function(t){e(I.actions.confirmMeeting({id:t}))},onChangeStatusClick:function(t){e(M.actions.changeStatus(t)),console.log("TODO change status. Ids need to be added to equipment")},onExtendMeetingClick:function(t,n){e(I.actions.extendMeeting({id:t,amount:n}))},onFinishEarlyClick:function(t){e(I.actions.finishEarly(t))}}})(P),Z=function(e){function t(){return Object(r.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return console.log("hello world","test"),a.a.createElement("div",{className:"App"},a.a.createElement($,null))}}]),t}(o.Component);n(56),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));(function(){console.log("hello world"),B.subscribe(function(){console.log(B.getState())}),B.dispatch(R.actions.addRoom(Object(g.a)({},new k("Supernova")))),B.dispatch(R.actions.addRoom(Object(g.a)({},new k("Room 2")))),B.dispatch(q.actions.setSelectedRoomId("Supernova")),B.dispatch(I.actions.addAllocation(Object(g.a)({},new f("Test allocation 2a","Room 2",Date.now()-12e5,Date.now()-12e5)))),B.dispatch(M.actions.addEquipment(Object(g.a)({},new D("Supernova",b.Projector,E.Available)))),B.dispatch(M.actions.addEquipment(Object(g.a)({},new D("Supernova",b.Skype,E.Available)))),B.dispatch(M.actions.addEquipment(Object(g.a)({},new D("Supernova",b.WhiteBoard,E.Available))));var e=H(B.getState()),t=W(B.getState()),n=X(B.getState()),o=Q(B.getState()),a=Y(B.getState())[0],i=G(B.getState());console.log("Name: ",e),console.log("Allocations: ",t),console.log("Occupied: ",o),console.log("Equipment: ",n),console.log("Current allocation: ",a),console.log("Next allocation: ",i),setInterval(function(){console.log("Interval"),B.dispatch(q.actions.setTime(Date.now()))},6e4)})(),c.a.render(a.a.createElement(l.a,{store:B},a.a.createElement(Z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[25,2,1]]]);
//# sourceMappingURL=main.879dfdd7.chunk.js.map